"use strict";var k=Object.create;var O=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var W=Object.getOwnPropertyNames;var Z=Object.getPrototypeOf,q=Object.prototype.hasOwnProperty;var z=(e,t)=>{for(var r in t)O(e,r,{get:t[r],enumerable:!0})},P=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of W(t))!q.call(e,o)&&o!==r&&O(e,o,{get:()=>t[o],enumerable:!(s=j(t,o))||s.enumerable});return e};var B=(e,t,r)=>(r=e!=null?k(Z(e)):{},P(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),G=e=>P(O({},"__esModule",{value:!0}),e);var J={};z(J,{RemoveSubscribe:()=>L,SUSPENSE:()=>i.SUSPENSE,Subscribe:()=>M,bind:()=>R,liftSuspense:()=>i.liftSuspense,shareLatest:()=>U,sinkSuspense:()=>i.sinkSuspense,state:()=>Y,useStateObservable:()=>c,withDefault:()=>i.withDefault});module.exports=G(J);var i=require("@rx-state/core");var u={};var N=require("@rx-state/core");function v(e,t){let s=(0,N.state)(...t===u?[e]:[e,t]);return[(...o)=>c(s(...o)),s]}var E=require("@rx-state/core");function y(e,t){let r=t===u?(0,E.state)(e):(0,E.state)(e,t);return[()=>c(r),r]}function R(e,t){return(typeof e=="function"?v:y)(e,arguments.length>1?t:u)}var m=require("rxjs"),U=()=>(0,m.share)({connector:()=>new m.ReplaySubject(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0});var F=require("@rx-state/core"),_=require("react");var p=require("@rx-state/core"),d=require("react");var n=B(require("react")),w=require("rxjs"),g=require("@rx-state/core");var C=(0,n.createContext)(null),{Provider:V}=C,D=()=>(0,n.useContext)(C),H=Promise.resolve(),I=()=>{throw H},M=({source$:e,children:t,fallback:r})=>{let s=(0,n.useRef)(void 0);if(!s.current){let a=new w.Subscription;s.current={s:a,u:S=>{let f=u,T=!0;if(a.add((0,g.liftSuspense)()(S).subscribe({error:h=>{if(T){f=h;return}b(()=>{throw h})}})),T=!1,f!==u)throw f}}}let[o,b]=(0,n.useState)(null);if(o!==null&&o!==e)if(e===void 0)b(e);else try{e.getValue(),b(e)}catch(a){}(0,n.useEffect)(()=>{if(b(e),!e)return;let a=(0,g.liftSuspense)()(e).subscribe({error:S=>b(()=>{throw S})});return()=>{a.unsubscribe()}},[e]),(0,n.useEffect)(()=>()=>{var a;(a=s.current)==null||a.s.unsubscribe(),s.current=void 0},[]);let l=o===e?n.default.createElement(V,{value:s.current.u},t):r===void 0?null:n.default.createElement(I,null);return r===void 0?l:o===null?r:n.default.createElement(n.Suspense,{fallback:r},l)},L=({children:e})=>n.default.createElement(V,{value:null},e);var c=e=>{let t=D(),[,r]=(0,d.useState)(),s=(0,d.useRef)(void 0);if(!s.current){let b=a=>{let S=a.getValue();if(S instanceof p.StatePromise)throw S.catch(f=>{if(f instanceof p.NoSubscribersError)return f;throw f});return S},l=()=>{let a=s.current.source$;if(!a.getRefCount()&&!a.getDefaultValue){if(!t)throw new Error("Missing Subscribe!");t(a)}return b(a)};s.current={source$:null,args:[,l,l]}}let o=s.current;return o.source$!==e&&(o.source$=e,o.args[0]=b=>{let l=(0,p.liftSuspense)()(e).subscribe({next:b,error:a=>{r(()=>{throw a})}});return()=>{l.unsubscribe()}}),(0,d.useSyncExternalStore)(...o.args)};var Y=(...e)=>{let t=(0,F.state)(...e);return typeof t=="function"?(...r)=>A(t(...r)):A(t)},x=new WeakMap;function A(e){x.has(e)||x.set(e,(0,_.createElement)(()=>c(e),{}));let t=e.pipeState.bind(e);return Object.assign(e,x.get(e),{pipeState:(...r)=>A(t(...r))})}
//# sourceMappingURL=core.cjs.production.min.js.map
